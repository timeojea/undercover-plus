<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Undercover+</title>
    
    <link rel="icon" type="image/png" href="app_logo.png">
    
    <link rel="stylesheet" href="style.css">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#9b59b6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Undercover+">
    <link rel="apple-touch-icon" href="app_logo.png">
</head>
<body>

    <div id="screen-setup" class="container">
        <div class="lang-switch">
            <button class="lang-btn active" id="btn-fr" onclick="setLanguage('fr')">FR</button>
            <button class="lang-btn" id="btn-en" onclick="setLanguage('en')">EN</button>
        </div>

        <img src="image_2.png" alt="Undercover Logo" class="logo-top">
        
        <div class="setup-section">
            <h3><span data-i18n="players_title">Joueurs</span> (<span id="player-count">0</span>)</h3>
            <div id="setup-players-list" class="grid-list"></div>
            <button class="btn btn-outline" onclick="openAddPlayerModal()" data-i18n="add_player_btn">+ Ajouter un joueur</button>
        </div>

        <div class="setup-section">
            <h3 data-i18n="settings_title">Paramètres</h3>
            
            <div class="settings-row">
                <label>Undercover</label>
                <div class="counter-box">
                    <button class="btn-counter" onclick="adjustCounter('undercover', -1)">-</button>
                    <span id="disp-undercover" class="counter-value">1</span>
                    <button class="btn-counter" onclick="adjustCounter('undercover', 1)">+</button>
                </div>
            </div>

            <div class="settings-row">
                <label>Mr. White</label>
                <div class="counter-box">
                    <button class="btn-counter" onclick="adjustCounter('white', -1)">-</button>
                    <span id="disp-white" class="counter-value">0</span>
                    <button class="btn-counter" onclick="adjustCounter('white', 1)">+</button>
                </div>
            </div>

            <label style="margin-top:10px; display:block; color:#aaa; font-size:0.9em;" data-i18n="theme_label">Thème des mots</label>
            <select id="category-select"></select>
        </div>

        <button class="btn btn-primary" onclick="setupGame()" data-i18n="start_btn">Lancer la partie</button>
    </div>

    <div id="screen-distrib" class="container hidden center-content">
        <img id="distrib-avatar" src="" class="avatar-large">
        <h2 id="distrib-player-name">Joueur X</h2>
        <p data-i18n="pass_phone">Passez le téléphone à ce joueur</p>
        
        <div id="secret-area" onmousedown="showSecret()" onmouseup="hideSecret()" ontouchstart="showSecret()" ontouchend="hideSecret()">
            <span id="secret-text" data-i18n="hold_reveal">Maintenir pour voir</span>
        </div>
        
        <button class="btn btn-primary" id="next-player-btn" onclick="nextPlayerDistrib()" data-i18n="validate_btn">Valider</button>
    </div>

    <div id="screen-game" class="container hidden">
        <div class="header-game">
            <h2 data-i18n="in_game">En jeu</h2>
        </div>
        <div id="game-players-list" class="list-vertical"></div>
        <button class="btn btn-secondary" onclick="backToSetup()" data-i18n="quit_btn">Quitter</button>
    </div>

    <div id="screen-end" class="container hidden center-content">
        <h1 id="winner-title" style="font-size: 2.5em;"></h1>
        <p data-i18n="winners_are">Les vainqueurs sont :</p>
        <div id="winners-list" class="grid-list" style="justify-content: center;"></div>
        
        <div style="margin-top: 30px; width: 100%;">
            <p style="font-weight: bold;" data-i18n="words_were">Les mots étaient :</p>
            <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
                <div><span style="color: var(--subtext);">Civils:</span> <br><strong id="end-civil-word" style="color: var(--text); font-size: 1.2em;"></strong></div>
                <div><span style="color: var(--subtext);">Undercover:</span> <br><strong id="end-under-word" style="color: var(--text); font-size: 1.2em;"></strong></div>
            </div>
        </div>

        <button class="btn btn-primary" onclick="backToSetup()" data-i18n="play_again_btn">Rejouer</button>
    </div>

    <div id="modal-add-player" class="modal hidden">
        <div class="modal-content">
            <h3 data-i18n="add_player_modal">Ajouter un joueur</h3>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('new')" data-i18n="tab_new">Nouveau</button>
                <button class="tab-btn" onclick="switchTab('existing')" data-i18n="tab_import">Importer</button>
            </div>

            <div id="tab-new" class="tab-content">
                <div class="avatar-upload">
                    <div class="avatar-row">
                        <label for="avatar-input">
                            <img id="preview-avatar" src="" class="avatar-medium">
                        </label>
                        <input type="file" id="avatar-input" accept="image/*" onchange="previewImage(this)" style="display:none;">
                        
                        <label for="avatar-input" class="change-photo-text" data-i18n="change_photo">Changer de photo</label>
                    </div>
                </div>
                
                <input type="text" id="new-player-name" placeholder="Nom du joueur">
                <button class="btn btn-primary" onclick="confirmAddPlayer()" data-i18n="add_btn">Ajouter</button>
            </div>

            <div id="tab-existing" class="tab-content hidden">
                <div id="saved-players-list" class="scroll-list"></div>
            </div>

            <button class="btn btn-text" onclick="closeAddModal()" data-i18n="close_btn">Fermer</button>
        </div>
    </div>

    <div id="check-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="check-modal-name">Nom</h3>
            <p data-i18n="secret_check">Vérification secrète</p>
            <div id="check-secret-box" class="secret-box-check"
                 onmousedown="revealCheck()" onmouseup="hideCheck()" ontouchstart="revealCheck()" ontouchend="hideCheck()">
                Maintenir
            </div>
            <button class="btn btn-secondary" onclick="closeCheckModal()" data-i18n="close_btn">Fermer</button>
        </div>
    </div>
    
    <div id="modal-white-guess" class="modal hidden">
        <div class="modal-content">
            <h3 data-i18n="mr_white_guess_title">Mr. White, devinez le mot !</h3>
            <p style="color:#aaa; font-size:0.9em;">C'est votre dernière chance de gagner.</p>
            <input type="text" id="white-guess-input" placeholder="Mot des Civils" style="text-align: center; font-size: 1.2em;">
            <button class="btn btn-primary" onclick="confirmWhiteGuess()" data-i18n="guess_confirm">Tenter ma chance</button>
            <button class="btn btn-text" onclick="cancelWhiteGuess()" style="margin-top:10px;">Abandonner</button>
        </div>
    </div>
    
    <svg id="user-icon-svg" class="hidden" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="60%" height="60%"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>

    <footer>Made with Luv & AI by Timéo</footer>

    <script src="data.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Enregistrement du Service Worker pour la PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker enregistré !', reg))
                    .catch(err => console.log('Erreur SW :', err));
            });
        }
    </script>
</body>
</html>